# 1 分片和副本

分片是将一个`Elasticsearch`索引分割成一些更小的索引的过程，这样才能在同一集群的不同节点上将它们分散开。

节点数和分片数、副本数的简单计算公式如下：

所需最大节点数=分片数*（副本数+1）

一个分片实际上是一个Lucene索引。更多的分片意味着每个在较小的Lucene索引上执行的操作会更快（尤其是索引过程）。

副本则解决了**日渐增长的吞吐量、高可用和容错的问题。**

**当一个存放主分片的节点失效后，Elasticsearch会把一个可用的副本升级为新的主分片。**默认情况下，Elasticsearch只为每个索引分片创建一个副本。然而，不同于分片的数量，**副本的数量可以通过相关的API随时更改**。该功能让构建应用程序变得非常方便，因为在需要更大的查询吞吐量时，使用副本就可以应对不断增长的并发查询。**增加副本数量可以让查询负载分散到更多机器上，理论上可以让Elasticsearch处理更多的并发请求**。

缺点也很明显：额外的副本占用了额外的存储空间，还有构建索引副本的开销。当然，主分片及其副本之间的数据同步也存在开销。